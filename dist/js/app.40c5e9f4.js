(function(){"use strict";var e={5092:function(e,t,o){var a=o(4220),n=o(8587),s=o(9812);const r={class:"app-container"};function i(e,t,o,a,n,i){const l=(0,s.up)("Menu"),d=(0,s.up)("SandBox"),c=(0,s.up)("Login"),u=(0,s.up)("EanLoader"),g=(0,s.up)("BookstoreList"),h=(0,s.up)("Prices"),m=(0,s.up)("MessageList");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(l),(0,s._)("div",r,[n.sandbox?((0,s.wg)(),(0,s.j4)(d,{key:0})):((0,s.wg)(),(0,s.iD)(s.HY,{key:1},[n.configStore.auth?((0,s.wg)(),(0,s.iD)(s.HY,{key:1},["Dodaj Eany"==n.menuStore.activeTab?((0,s.wg)(),(0,s.j4)(u,{key:0})):(0,s.kq)("",!0),"Ustawienia Księgarń"!=n.menuStore.activeTab||n.sandbox?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(g,{key:1})),"Pobrane Ceny"!=n.menuStore.activeTab||n.sandbox?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(h,{key:2}))],64)):((0,s.wg)(),(0,s.j4)(c,{key:0}))],64)),(0,s.Wm)(m)])],64)}var l=o(5893);const d={class:"messages"};function c(e,t,o,n,r,i){const c=(0,s.up)("Message");return(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",{class:(0,l.C_)(["main",{hidden:!r.messageStore.newMessage}])},[(0,s._)("div",{class:"delete-all",onClick:t[0]||(t[0]=e=>r.messageStore.deleteAll())},"Wyczyść"),(0,s._)("div",d,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.messageStore.messages,(t=>(0,s.wy)(((0,s.wg)(),(0,s.j4)(c,{message:t,key:t.msg+t.time},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(t.msg),1)])),_:2},1032,["message"])),[[a.F8,!e.hidden||r.messageStore.newMessage]]))),128))])],2)),[[a.F8,r.messageStore.messages.length>0]])}const u=(0,n.Q_)("messageStore",{state(){return{messages:[],newMessage:!1}},actions:{addMessage(e,t,o){this.messages.unshift({type:e,msg:t,...o,time:(new Date).toLocaleString("pl-PL").replace(/\d+\.\d+\.\d+, /,"")}),this.setNewMessageState(!0)},deleteMessage(e){this.messages.splice(this.messages.indexOf(e),1)},setNewMessageState(e){this.newMessage=e},deleteAll(){this.messages=[]}}}),g={class:"time"},h=["href"];function m(e,t,o,a,n,r){return(0,s.wg)(),(0,s.iD)("div",{class:(0,l.C_)(["box",o.message.type])},[(0,s._)("div",g,(0,l.zw)(o.message.time),1),(0,s._)("div",null,[(0,s.WI)(e.$slots,"default",{},void 0,!0)]),o.message.url?((0,s.wg)(),(0,s.iD)("a",{key:0,target:"_blank",href:o.message.url},"KLIK",8,h)):(0,s.kq)("",!0),(0,s._)("div",{class:"close",onClick:t[0]||(t[0]=e=>n.messageStore.deleteMessage(o.message))},"❌")],2)}var f={name:"Message",props:["message"],data(){return{messageStore:u()}}},v=o(8998);const p=(0,v.Z)(f,[["render",m],["__scopeId","data-v-8d8b387e"]]);var w=p,b={name:"MessageList",components:{Message:w},data(){return{messageStore:u()}},methods:{}};const k=(0,v.Z)(b,[["render",c],["__scopeId","data-v-006374aa"]]);var S=k;const y={class:"main"},_={class:"run-box"};function x(e,t,o,a,n,r){const i=(0,s.up)("Bookstore");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",y,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(Object.keys(n.configStore.bookstores),(e=>((0,s.wg)(),(0,s.j4)(i,{key:e,bookstore:e},null,8,["bookstore"])))),128))]),(0,s._)("div",_,[(0,s._)("div",{class:(0,l.C_)(["btn",{active:r.btnActive,start:r.btnGreen,stop:!r.btnGreen}]),onClick:t[0]||(t[0]=(...e)=>r.manageClick&&r.manageClick(...e))},(0,l.zw)(r.btnText),3)])],64)}const D=(0,n.Q_)("configStore",{state(){return{auth:!1,bookstores:{gandalf:{name:"gandalf",delays:{min:5,max:7},productPages:{},download:{default:{value:!1,async strategy(e){const{ean:t,thread:o}=e,a=await fetch(`https://www.gandalf.com.pl/sxa/${t.code}`,{credentials:"include",mode:"cors"}),n=await a.text(),s=(new DOMParser).parseFromString(n,"text/html"),r=s.querySelector("ul.internal-list span.current-price.f-20.bold-700")?.textContent.trim().replaceAll(/[^\d,]/g,""),i=s.querySelector("ul.internal-list .info-box a:first-child")?.href;D().bookstores["gandalf"].productPages[t.code]=i,t.prices[o.name]||(t.prices[o.name]={}),t.prices[o.name].default=r}},google:{value:!1,async strategy(e){const{ean:t,thread:o}=e,a=D().bookstores["gandalf"].productPages[t.code];if(!a)return;const n=a.match(/\?/)?"&":"?",s=await fetch(`${a}${n}utm_source=google`,{credentials:"include",mode:"cors"}),r=await s.text(),i=(new DOMParser).parseFromString(r,"text/html"),l=i.querySelector(".internal-price-box .current-price strong")?.textContent.trim().replaceAll(/[^\d,]/g,"");t.prices[o.name]||(t.prices[o.name]={}),t.prices[o.name].google=l}}},searchURL:""},bonito:{name:"bonito",delays:{min:2,max:4},download:{default:{value:!1},google:{value:!1}},searchURL:""},tantis:{name:"tantis",delays:{min:2,max:4},download:{default:{value:!1},google:{value:!1}},searchURL:""},"świat_książki":{name:"świat_książki",delays:{min:2,max:4},download:{default:{value:!1},google:{value:!1}},searchURL:""},empik:{name:"empik",delays:{min:2,max:4},download:{default:{value:!1},google:{value:!1}},searchURL:""}}}},actions:{activateDownload(e,t){this.canBeDownloaded(e,t)&&(this.bookstores[e].download[t].value=!0)},deactivateDownload(e,t){this.bookstores[e].download[t].value=!1},canBeDownloaded(e,t){return this.bookstores[e].download[t].strategy},isDownloading(e,t){return this.bookstores[e].download[t].value},isBookstoreActive(e){return this.bookstores[e].download["default"].value||this.bookstores[e].download["google"].value}},getters:{anythingToDownload(){for(const e of Object.values(this.bookstores))for(const t of Object.values(e.download))if(t.value)return!0;return!1}}}),j=e=>((0,s.dD)("data-v-4617c51e"),e=e(),(0,s.Cn)(),e),I=j((()=>(0,s._)("div",{class:"delays-text"},"opóźnienia",-1))),C={class:"delays"},L=["max"],z=["min"],O={class:"left-in-queue"},M=j((()=>(0,s._)("span",null,"pozostało:",-1)));function B(e,t,o,n,r,i){const d=(0,s.up)("BookstorePriceToggler");return(0,s.wg)(),(0,s.iD)("div",{class:(0,l.C_)(["main",{active:i.active&&i.left>0}])},[(0,s._)("h3",null,(0,l.zw)(r.configStore.bookstores[o.bookstore].name),1),((0,s.wg)(),(0,s.iD)(s.HY,null,(0,s.Ko)(["default","google"],(e=>(0,s.Wm)(d,{key:e,download:e,bookstore:o.bookstore},null,8,["download","bookstore"]))),64)),I,(0,s._)("div",C,[(0,s.wy)((0,s._)("input",{type:"number",min:"1",max:r.configStore.bookstores[o.bookstore].delays.max,"onUpdate:modelValue":t[0]||(t[0]=e=>r.configStore.bookstores[o.bookstore].delays.min=e)},null,8,L),[[a.nr,r.configStore.bookstores[o.bookstore].delays.min]]),(0,s.wy)((0,s._)("input",{type:"number",min:r.configStore.bookstores[o.bookstore].delays.min,max:"20","onUpdate:modelValue":t[1]||(t[1]=e=>r.configStore.bookstores[o.bookstore].delays.max=e)},null,8,z),[[a.nr,r.configStore.bookstores[o.bookstore].delays.max]])]),(0,s._)("div",O,[M,(0,s._)("span",null,(0,l.zw)(i.left),1)])],2)}function T(e,t,o,a,n,r){const i=(0,s.up)("TogglerBtn");return(0,s.wg)(),(0,s.j4)(i,{onClick:r.toggle,active:n.configStore.isDownloading(o.bookstore,o.download),disabled:!n.configStore.canBeDownloaded(o.bookstore,o.download),title:n.configStore.canBeDownloaded(o.bookstore,o.download)?"":"Obsługa nie została zaimplementowana"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)("google"==o.download?"Google":"Zwykłe"),1)])),_:1},8,["onClick","active","disabled","title"])}function q(e,t,o,a,n,r){return(0,s.wg)(),(0,s.iD)("div",{class:(0,l.C_)({active:o.active,disabled:o.disabled})},[(0,s._)("span",null,(0,l.zw)(o.active?"✔️":"❌"),1),(0,s.WI)(e.$slots,"default",{},void 0,!0)],2)}var E={name:"TogglerBtn",props:{active:{type:Boolean,required:!1,default:!1},disabled:{type:Boolean,required:!1,default:!1}}};const P=(0,v.Z)(E,[["render",q],["__scopeId","data-v-903cd674"]]);var F=P;o(7658);const U=(0,n.Q_)("eanStore",{state(){return{eans:{},empty:!0}},actions:{loadEans(e,t=!1){if("overwrite"==t)for(const o in this.eans)delete this.eans[o];"string"==typeof e&&(e=e.split("\n").map((e=>e.trim())).filter((e=>e)));for(const o of e)this.eans[o]={code:o,prices:{}};this.empty=0==Object.keys(this.eans).length},removeEan(e){this.eans[e]&&delete this.eans[e],this.empty=0==Object.keys(this.eans).length}}}),Z=(0,n.Q_)("ajaxStore",{state(){return{checkingIfFinishedInterval:null,messageStore:u(),configStore:D(),eanStore:U(),threads:{}}},actions:{rand(e,t){return Math.floor(Math.random()*(t-e))+e},initThread(e){this.threads[e]||(this.threads[e]={name:e,interval:null,lastReq:null,queue:[]})},isLocked(e){if(!e.lastReq)return!1;const t=Date.now(),o=this.rand(1e3*this.configStore.bookstores[e.name].delays.min,1e3*this.configStore.bookstores[e.name].delays.max);return t<=e.lastReq+o},lock(e){e.lastReq=Date.now()},runThreads(){if(this.checkingIfFinishedInterval)return;for(const t of Object.values(this.configStore.bookstores))this.threads[t.name]||!t.download.default.value&&!t.download.google.value||this.initThread(t.name);const e=Object.values(this.threads);if(e.length){for(const t of e){for(const e of Object.values(this.configStore.bookstores[t.name].download))if(e.value&&e.strategy)for(const o of Object.values(this.eanStore.eans))t.queue.push({strategy:e.strategy,data:{ean:o,thread:t}});t.interval=setInterval((()=>{if(t.queue.length){if(!this.isLocked(t)&&this.configStore.bookstores[t.name].download.default.value){const{strategy:e,data:o}=t.queue.shift();e(o),this.lock(t)}}else clearInterval(t.interval),t.interval=null}),1e3)}this.checkingIfFinishedInterval=setInterval((()=>{Object.values(this.threads).filter((e=>e.interval)).length||(this.messageStore.addMessage("success","Pobieranie cen zakończone powodzeniem."),clearInterval(this.checkingIfFinishedInterval),this.checkingIfFinishedInterval=null)}),1e3)}},pauseThreads(){for(const e of Object.values(this.threads))clearInterval(e.interval),e.interval=null;clearInterval(this.checkingIfFinishedInterval),this.checkingIfFinishedInterval=null}}});var K={name:"BookstorePriceToggler",components:{TogglerBtn:F},props:{bookstore:{type:String,required:!0},download:{type:String,required:!0}},data(){return{configStore:D(),ajaxStore:Z()}},methods:{toggle(){this.configStore.isDownloading(this.bookstore,this.download)?this.configStore.deactivateDownload(this.bookstore,this.download):this.configStore.canBeDownloaded(this.bookstore,this.download)&&this.configStore.activateDownload(this.bookstore,this.download)}}};const A=(0,v.Z)(K,[["render",T]]);var H=A,W={name:"Bookstore",props:{bookstore:{type:String,required:!0}},components:{BookstorePriceToggler:H},data(){return{configStore:D(),ajaxStore:Z()}},computed:{active(){return this.configStore.isBookstoreActive(this.bookstore)},left(){return this.ajaxStore.threads[this.bookstore]?.queue.length}}};const Y=(0,v.Z)(W,[["render",B],["__scopeId","data-v-4617c51e"]]);var R=Y,G={name:"BookstoreList",components:{Bookstore:R},data(){return{configStore:D(),ajaxStore:Z(),eanStore:U()}},methods:{manageClick(){this.btnActive&&(this.btnGreen?this.ajaxStore.runThreads():this.ajaxStore.pauseThreads())}},computed:{btnGreen(){return!this.ajaxStore.checkingIfFinishedInterval},btnText(){return this.btnGreen?"start":"stop"},btnActive(){return this.configStore.anythingToDownload&&Object.keys(this.eanStore.eans).length}}};const N=(0,v.Z)(G,[["render",x],["__scopeId","data-v-17b5ffbf"]]);var Q=N;const $={class:"menu"},V=["onClick"];function J(e,t,o,a,n,r){return(0,s.wg)(),(0,s.iD)("div",$,[((0,s.wg)(),(0,s.iD)(s.HY,null,(0,s.Ko)(["Ustawienia Księgarń","Dodaj Eany","Pobrane Ceny","Logi"],(e=>(0,s._)("div",{class:(0,l.C_)({active:n.menuStore.activeTab==e}),key:e,onClick:t=>n.menuStore.activeTab=e},(0,l.zw)(e),11,V))),64))])}const X=(0,n.Q_)("menuStore",{state(){return{activeTab:null}},actions:{}});var ee={name:"Menu",data(){return{menuStore:X()}}};const te=(0,v.Z)(ee,[["render",J],["__scopeId","data-v-20466e8c"]]);var oe=te;const ae={class:"wrapper"};function ne(e,t,o,a,n,r){return(0,s.wg)(),(0,s.iD)("div",ae)}var se={name:"SandBox",components:{},data(){return{messageStore:u()}}};const re=(0,v.Z)(se,[["render",ne],["__scopeId","data-v-5eec3dd6"]]);var ie=re;const le={class:"ean-loader"},de={class:"options"},ce={class:"ean-list-wrapper"},ue={class:"ean-list"},ge=["onClick"];function he(e,t,o,n,r,i){return(0,s.wg)(),(0,s.iD)("div",le,[(0,s._)("div",de,[(0,s.wy)((0,s._)("div",{onClick:t[0]||(t[0]=(...e)=>i.loadEans&&i.loadEans(...e))},(0,l.zw)(i.addString),513),[[a.F8,r.eans]]),(0,s.wy)((0,s._)("div",{onClick:t[1]||(t[1]=e=>i.loadEans("overwrite"))},"Nadpisz",512),[[a.F8,r.eans&&!r.eanStore.empty]]),(0,s.wy)((0,s._)("div",{onClick:t[2]||(t[2]=(...e)=>i.clearEans&&i.clearEans(...e))},"Wyczyść Listę",512),[[a.F8,!r.eanStore.empty]])]),(0,s._)("div",ce,[(0,s.wy)((0,s._)("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>r.eans=e)},null,512),[[a.nr,r.eans]]),(0,s._)("div",ue,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.eanStore.eans,(e=>((0,s.wg)(),(0,s.iD)("div",{key:e.code,class:"ean-item"},[(0,s._)("span",{class:"delete",onClick:t=>r.eanStore.removeEan(e.code)},"❌",8,ge),(0,s._)("span",null,(0,l.zw)(e.code),1)])))),128))])])])}var me={name:"EanLoader",data(){return{eanStore:U(),eans:""}},methods:{loadEans(e=!1){this.eanStore.loadEans(this.eans,e),this.eans=""},clearEans(){this.eanStore.loadEans("","overwrite")}},computed:{addString(){return"Dodaj"+(Object.keys(this.eanStore.eans).length>0?" do istniejących":"")}}};const fe=(0,v.Z)(me,[["render",he],["__scopeId","data-v-1bb47dd6"]]);var ve=fe;function pe(e,t,o,a,n,r){return(0,s.wg)(),(0,s.iD)("ul",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(n.eanStore.eans,(e=>((0,s.wg)(),(0,s.iD)("li",{key:e.code},(0,l.zw)(e.code)+": "+(0,l.zw)(e.prices),1)))),128))])}var we={name:"Prices",data(){return{eanStore:U()}}};const be=(0,v.Z)(we,[["render",pe]]);var ke=be;const Se=e=>((0,s.dD)("data-v-6fc277fd"),e=e(),(0,s.Cn)(),e),ye={class:"login-box"},_e=Se((()=>(0,s._)("span",null,"Hasło",-1)));function xe(e,t,o,n,r,i){return(0,s.wg)(),(0,s.iD)("div",ye,[_e,(0,s.wy)((0,s._)("input",{type:"password",autofocus:"","onUpdate:modelValue":t[0]||(t[0]=e=>r.password=e),onKeyup:t[1]||(t[1]=(0,a.D2)(((...e)=>i.doLogin&&i.doLogin(...e)),["enter"]))},null,544),[[a.nr,r.password]]),(0,s._)("button",{onClick:t[2]||(t[2]=(...e)=>i.doLogin&&i.doLogin(...e))},"Zaloguj")])}var De={name:"Login",data(){return{password:"",messageStore:u(),configStore:D()}},methods:{doLogin(){"gloselowicz1"===this.password?(localStorage.setItem("auth","6ec58d2f6c08aa9ec5eb84db49281b4c"),this.configStore.auth=!0):(localStorage.removeItem("auth"),this.messageStore.addMessage("danger","Hasło nieprawidłowe. Spróbuj ponownie."),this.password="")}}};const je=(0,v.Z)(De,[["render",xe],["__scopeId","data-v-6fc277fd"]]);var Ie=je,Ce={name:"App",components:{MessageList:S,BookstoreList:Q,SandBox:ie,Menu:oe,EanLoader:ve,Prices:ke,Login:Ie},data(){return{messageStore:u(),menuStore:X(),configStore:D(),sandbox:!1}},mounted(){"6ec58d2f6c08aa9ec5eb84db49281b4c"==localStorage.getItem("auth")&&(this.configStore.auth=!0),this.menuStore.activeTab="Ustawienia Księgarń",fetch("https://google.pl/",{credentials:"include",mode:"cors"}).then((()=>{this.messageStore.addMessage("success","Konfiguracja prawidłowa, możemy zaczynać.")})).catch((e=>{"NetworkError when attempting to fetch resource."==e.message&&this.messageStore.addMessage("danger",'UWAGA! Nie będę mógł pobierać cen z bonito. Włącz dodatek "Corse everywhere" w przeglądarce i odśwież stronę.',{url:"https://addons.mozilla.org/en-US/firefox/addon/cors-everywhere/"})}))}};const Le=(0,v.Z)(Ce,[["render",i]]);var ze=Le;const Oe=(0,n.WB)(),Me=(0,a.ri)(ze);Me.use(Oe),Me.mount("#price-scraper-app")}},t={};function o(a){var n=t[a];if(void 0!==n)return n.exports;var s=t[a]={exports:{}};return e[a].call(s.exports,s,s.exports,o),s.exports}o.m=e,function(){var e=[];o.O=function(t,a,n,s){if(!a){var r=1/0;for(c=0;c<e.length;c++){a=e[c][0],n=e[c][1],s=e[c][2];for(var i=!0,l=0;l<a.length;l++)(!1&s||r>=s)&&Object.keys(o.O).every((function(e){return o.O[e](a[l])}))?a.splice(l--,1):(i=!1,s<r&&(r=s));if(i){e.splice(c--,1);var d=n();void 0!==d&&(t=d)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[a,n,s]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};o.O.j=function(t){return 0===e[t]};var t=function(t,a){var n,s,r=a[0],i=a[1],l=a[2],d=0;if(r.some((function(t){return 0!==e[t]}))){for(n in i)o.o(i,n)&&(o.m[n]=i[n]);if(l)var c=l(o)}for(t&&t(a);d<r.length;d++)s=r[d],o.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return o.O(c)},a=self["webpackChunkprice_scraper"]=self["webpackChunkprice_scraper"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=o.O(void 0,[998],(function(){return o(5092)}));a=o.O(a)})();
//# sourceMappingURL=app.40c5e9f4.js.map